# 总的业务模块

- 用户管理：
  - 会员管理 ：可编辑会员用户的信息
  - 收货地址：查看用户的收货地址
  - 会员收藏：查看会员收藏的商品的详情
  - 会员足迹：查看会员浏览商品的详情
  - 搜索历史：查看会员搜索历史
  - 意见反馈：查看会员反馈的意见
- 商场管理
  - 行政区域： 查看所有的省、市
  - 品牌制造商：操作商品的品牌商
  - 商品类目：操作商品的类目，一级、二级
  - 订单管理：查看订单信息、确认收款、发货、退款、删除订单
  - 售后管理：审核、退款退款的订单
  - 通用问题：编辑前台系统显示的通用问题
  - 关键词：编辑关键词
- 商品管理
  - 商品列表：查看所有的商品、编辑商品的信息，包括基本信息、规格、库存、参数
  - 商品上架：同上
  - 商品评论：查看、回复、删除会员的评论
- 推广管理
  - 广告管理：查看、编辑广告
  - 优惠券管理：查看优惠券、编辑优惠券，包括满减、限额、类型、有效期、限制的商品类别等
  - 专题管理：查看、编辑专题，设置专题的基本信息，包括添加专题中的商品
  - 团购规则：查看、编辑团购规则，包括作用的商品、折扣、人数要求、过期时间
  - 团购活动：查看所有的团购活动
- 系统管理
  - 管理员：编辑管理员用户。包括超级管理员：所有模块的权限；商场管理：商场模块的操作权限；商户：商品管理的操作权限；推广管理员：推广管理权限
  - 角色管理：编辑角色，包括：上述。不同的角色拥有不同的模块的不同的rest接口权限，可以增删改角色，拥有不用的rest接口权限。
  - 通知管理：增删该通知消息
  - 操作日志：查看所有的操作日志，包括安全操作 登录、订单操作等
  - 对象存储：oss存储文件。增删该上传的文件
- 配置管理
  - 商场配置：设置网上商场的基本信息
  - 运费配置：设置运费的满减规则
  - 订单配置：订单的下单超时、发货超期、确认未评价时间设置
  - 小程序配置：微信小程序前台系统设置，包括新品、人气推荐、品牌制造商直售、专题显示的商品数量、分类栏目数量、微信商品分享
- 统计报表：用户统计、订单统计、商品统计
- 外链：云存储OSS、云短信SMS、微信支付、快递鸟



# 技术点

- 定时任务@Scheduled， 定时查看优惠券是否超时、订单是否超时确认、评价；备份db，删除过期的备份db。定时的配置
- 异步任务@Async，异步给用户发送退款成功的短信消息。异步的配置@EnableAsync
- kaptcha验证码配置及服务
- Shiro认证及授权配置及服务，结合内置及自定义注解实现。。。
- 操作日志实现LogHelper：一般日志、安全日志、订单日志、其他日志
- 

## shiro(权限管理框架)

> https://zhuanlan.zhihu.com/p/54176956
>
> https://segmentfault.com/a/1190000013875092

关键概念：

- SecurityManager：管理所有Subject，SecurityManager 是 Shiro 架构的核心，配合内部安全组件共同组成安全伞。
- Realms：用于进行权限信息的验证，我们自己实现。Realm 本质上是一个特定的安全 DAO：它封装与数据源连接的细节，得到Shiro 所需的相关的数据。在配置 Shiro 的时候，你必须指定至少一个Realm 来实现认证（authentication）和/或授权（authorization），通过realm去数据库查询数据的。

用户认证中的概念：

- subject主体：**理解为用户,可能是程序，都要去访问系统的资源，系统需要对subject进行身份认证**
- principal身份信息：**通常是唯一的，一个主体还有多个身份信息**，但是都有一个主身份信息（primary principal
- credential凭证信息：**可以是密码 、证书、指纹。**

权限中资源的分类：

- 后端的rest接口 method+url
- 前端中的菜单
- 前端中的按钮

登录时的认证逻辑ok

其他controller的认证流程：通过当前的session中的用户？？？？？；授权：通过当前用户的权限？？？？



# 服务类

只介绍其中的重要的，其他的基本上是简单的增删改。。。

- AdminAuthController： 用户登录认证

  - 验证码 kaptcha：随机生成验证码字符串，塞到当前会话中；绘制验证码图片并返回前端验证码图片base64流；用户登录时根据输入的验证码与当前会话中的验证码对比
  - shiro 登录认证 shiro配置及使用。admin/auth/login
  - 获取当前用户拥有的权限；根据spring上下文及限定的包范围查找所有controller，通过其中的注解查看权限（admin:category:read）与接口api的map（GET /admin/category/read）；根据当前用户的权限过滤获取拥有权限的接口的api的串。 toApi

  ```flow
  st=>start: 开始
  e=>end: 结束
  op=>operation: 生成验证码字符串塞到当前会话中，绘制验证码图片base64编码返回给前端
  op2=>operation: 用户登录，将用户输入的验证码与会话中的验证码对比
  op3=>operation: 验证用户、密码。。。
  st->op->op2->op3
  ```

  

- AdminRoleController：角色服务

  - 权限的自定义注解：RequiresPermissions （admin:ad:list）；RequiresPermissionsDesc（菜单，按钮，权限控制？？？角色授权里） **PermissionUtil。。。**
  -  

- AdminGoodsController：商品处理的业务逻辑

- AdminOrderController：订单的一些业务处理逻辑



# core模块

- 物流express配置及service
- 邮件通知、sms短信通知配置及service
- 二维码创建绘制service
- OSS对象存储配置及service
- 系统的初始配置
- 延时队列
- 各种util：加解密、BeanUtil、随机字符串、日期、http post、ip获取、jackson、常用正则匹配、专用响应、专用打印器

# db模块

并不好拆，很对表都共用。。。后台系统多写，前台系统多读。

## 后台系统单独的表

- litemall_admin
- litemall_role
- litemall_permission
- 



## 前台系统独有的表

- 



## 共有的表

- 专题
- 优惠券
- 团购
- 商品
- 订单
- 

# 总结

## 日志logback

- 目前的配置的日志，根据日期，每一天的日志分割生成一个日志文件。
- 

## 配置

- 
- 